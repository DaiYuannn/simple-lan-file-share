<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>局域网文件分享</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'fileshare/main.css' %}">
    <script src="{% static 'fileshare/main.js' %}" defer></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>局域网文件分享</h1>
            <p>在同一局域网内快速上传和下载文件。</p>
        </header>

        <section class="upload-panel">
            <h2>上传文件</h2>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="field-group">
                    <label for="name">文件名称（可选）</label>
                    <input type="text" id="name" name="name" placeholder="例如：会议PPT">
                </div>
                <div class="field-group">
                    <label for="file">选择文件</label>
                    <input type="file" id="file" name="file" required>
                </div>
                <button type="submit">上传</button>
            </form>
        </section>

        <section class="file-list">
            <h2>公共文件库</h2>
            {% if files %}
                <table>
                    <thead>
                        <tr>
                            <th>名称</th>
                            <th>上传时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for file in files %}
                            <tr>
                                <td>{{ file.name|default:file.file.name }}</td>
                                <td>{{ file.uploaded_at|date:"Y-m-d H:i" }}</td>
                                <td>
                                    <a href="{{ file.file.url }}" download>下载</a>
                                    {% if is_admin %}
                                        |
                                        <a href="{% url 'fileshare:delete' file.pk %}" onclick="return confirm('确定要删除这个文件吗？');">删除</a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="empty">当前还没有文件，赶快上传一个吧。</p>
            {% endif %}
        </section>
    </div>
</body>
</html>
